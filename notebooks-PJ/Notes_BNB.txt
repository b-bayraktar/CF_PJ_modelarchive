Step 1 : Run "..\modflow\notebooks\export_boundary_shapefiles_PJ.ipynb" notebook. This notebook generates the shapefile with the modflow model cells that we want to be coupled. It also reprojects the cells to match the crs of dflow-fm. For the PJ model, most perimeter CHDs are not included, except the ones on the coast.

Step 2: Run ".\step1a_calculate_dflow2mfghb_factors.ipynb" notebook

Step 3: Run ".\step1b_calculate_dflow2mfchd_factors.ipynb" notebook

Step 4: Run ".\step2_run_dflow-modflow_variable_dt.ipynb" notebook


Notes & troubleshooting tips: 
- Coupling MF with Dflow requires 2 CHD packages - one of them specific to the cells that will be coupled.
- Dflow-FM grid must completely overlap all Modflow cells that are to be coupled. Otherwise, kernel crashes when coupling.
- Kernel may crash if there are too many DLLs in that directory? I can't remember the issue exactly but Kalle and Liv know. 
- The bottom elevations of the first layer of the groundwater models GHBs and CHDs must be at a low enough elevation so that these cells do not dry out when DFlow-FM values are coupled at low tide. If these cells dry out, the model and coupling will crash. The solution is to ensure the bottom elevation of these cells are lowered to be equal to the lowest possible tide water level. 

Step 3 notes:
GHB_obs.csv 
Observation Type (obstype): GHB = Flow between the groundwater system and a general-head boundary or group of general-head boundaries.

chd_coastal_obs.csv 
Observation Type (obstype): CHD = Flow between the groundwater system and a constant-head boundary or a group of cells with constant-head boundaries.

questions:
-in an obs.csv negative means water is entering the GHB/CHD from the model, right? so a negative means the cell is gaining water?
- The total GHB exchange is variable , while the total CHD exchange stays constant... Why does summing all the chds even out? If you look at individual CHDs, you can see the exchange
- model loses A LOT more water to CHD than GHB


9/16/2025
- MF + Dflow + SWMM are coupled for PJ 
- Figure with the difference in coastal water level with and without atmospheric inputs is in the figures directory.